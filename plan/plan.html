<!DOCTYPE html>
<html>
<head>
<title>Стенд тестирования функции планирования</title>
<meta charset="utf-8" />
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script>

function maketable(data) {
    let tbl = "";
    let tbh = "";
    data.forEach(function(row){
	if (tbh == "") {
	  tbh = tbh + "<tr>";
	  for (col in row) {
	    tbh = tbh + "<th>" + col + "</th>";
	  }
  	  tbh = tbh + "</tr>";
	}
	tbl = tbl + "<tr>";
	for (col in row) {
	  tbl = tbl + "<td>" + row[col] + "</td>";
	}
	tbl = tbl + "</tr>";
    });
    return('<table border="1" style="border-collapse:collapse;">' + tbh +  tbl + '</table>');
}

$(document).ready(function (){ 	
  var stepname = "";
  var init = false;
//window.onerror = function(msg, url, lineNo, columnNo, error) {
//	alert(stepname +":\n" + msg + "\n" + url);
//	return false;
//  }
  $("#submit").click(function(){
	document.getElementById('a').innerHTML = "..............";
	document.getElementById('b').innerHTML = "..............";
	document.getElementById('c').innerHTML = "..............";

	let scriptname = $("#module").val();
	console.log(scriptname + "\nrequested\n" + js);
	try {
		//$.getScript(scriptname);
		if (init) {
		  let el = document.getElementsByTagName('script')[0];
		  //el.parentNode.removeChild(el);
		  el.remove();
		}
		var firstScript = document.getElementsByTagName('script')[0];
		var js = document.createElement('script');
		js.src = scriptname;
		js.onload = function () {
			console.log(scriptname + " loaded");
			try {
				let srt = $("#sort").val();
				let pln = 
[	
	{
            "PL": "1",
            "DT": "d1",
            "Q": "100",
            "T": "01/21/2021",
            "D": "5",
            "P": "400000"
        },

        {
            "PL": "2",
            "DT": "d2",
            "Q": "110",
            "T": "01/22/2021",
            "D": "5",
            "P": "500000"
        },

        {
            "PL": "3",
            "DT": "d3",
            "Q": "120",
            "T": "01/23/2021",
            "D": "5",
            "P": "380000"
        },

        {
            "PL": "4",
            "DT": "d4",
            "Q": "130",
            "T": "01/21/2021",
            "D": "3",
            "P": "430000"
        },

        {
            "PL": "5",
            "DT": "d5",
            "Q": "140",
            "T": "01/22/2021",
            "D": "6",
            "P": "290000"
        },

        {
            "PL": "6",
            "DT": "d6",
            "Q": "100",
            "T": "01/28/2021",
            "D": "2",
            "P": "800000"
        },

        {
            "PL": "7",
            "DT": "d7",
            "Q": "120",
            "T": "01/18/2021",
            "D": "3",
            "P": "530000"
        },

        {
            "PL": "8",
            "DT": "d8",
            "Q": "140",
            "T": "02/02/2021",
            "D": "2",
            "P": "450000"
        }
];
				let prm = 
[
      { 
         "id":1,
         "WC": "рц_1",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "1",
         "T": "300",
         "D": "4",
         "P": "50"
      },
   
      {
         "id":2,
         "WC": "рц_1",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "1",
         "T": "360",
         "D": "3",
         "P": "70"
      },

      {
         "id":3,
         "WC": "рц_1",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "1",
         "T": "280",
         "D": "6",
         "P": "40"
      },
   
      {
         "id":4,
         "WC": "рц_1",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "1",
         "T": "400",
         "D": "2",
         "P": "100"
      },
   
      {
         "id":5,
         "WC": "рц_1",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "1",
         "T": "380",
         "D": "5",
         "P": "40"
      },
  
      {
         "id":6,
         "WC": "рц_1",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "1",
         "T": "380",
         "D": "3",
         "P": "70"
      },
 
      {
         "id":8,
         "WC": "рц_1",
         "PL": "3",
         "DT": "д3",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },
  
      {
         "id":9,
         "WC": "рц_1",
         "PL": "4",
         "DT": "д4",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },
  
      {
         "id":10,
         "WC": "рц_1",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "1",
         "T": "500",
         "D": "1",
         "P": "80"
      },
  
      {
         "id":11,
         "WC": "рц_1",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "1",
         "T": "300",
         "D": "4",
         "P": "40"
      },
  
      {
         "id":12,
         "WC": "рц_1",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "1",
         "T": "450",
         "D": "2",
         "P": "75"
      },
   
      {
         "id":13,
         "WC": "рц_1",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "1",
         "T": "200",
         "D": "6",
         "P": "33"
      },
   
      {
         "id":14,
         "WC": "рц_1",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "1",
         "T": "800",
         "D": "4",
         "P": "47"
      },
 
      {
         "id":15,
         "WC": "рц_1",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "1",
         "T": "430",
         "D": "8",
         "P": "20"
      },
   
      {
         "id":15,
         "WC": "рц_1",
         "PL": "7",
         "DT": "д7",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },
   
      {
         "id":16,
         "WC": "рц_1",
         "PL": "8",
         "DT": "д8",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },
  
      {
         "id":17,
         "WC": "рц_2",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "2",
         "T": "280",
         "D": "3",
         "P": "240"
      },

      {
         "id":18,
         "WC": "рц_2",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "2",
         "T": "300",
         "D": "5",
         "P": "150"
      },

      {
         "id":19,
         "WC": "рц_2",
         "PL": "1",
         "DT": "д1",
         "OP": "о1",
         "Q": "2",
         "T": "450",
         "D": "4",
         "P": "160"
      },

      {
         "id":20,
         "WC": "рц_2",
         "PL": "2",
         "DT": "д2",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":21,
         "WC": "рц_2",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "3",
         "T": "500",
         "D": "3",
         "P": "330"
      },

      {
         "id":22,
         "WC": "рц_2",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "3",
         "T": "620",
         "D": "5",
         "P": "285"
      },

      {
         "id":23,
         "WC": "рц_2",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "3",
         "T": "800",
         "D": "1",
         "P": "390"
      },

      {
         "id":24,
         "WC": "рц_2",
         "PL": "4",
         "DT": "д4",
         "OP": "о1",
         "Q": "2",
         "T": "618",
         "D": "2",
         "P": "160"
      },

      {
         "id":25,
         "WC": "рц_2",
         "PL": "4",
         "DT": "д4",
         "OP": "о1",
         "Q": "2",
         "T": "315",
         "D": "5",
         "P": "208"
      },

      {
         "id":26,
         "WC": "рц_2",
         "PL": "4",
         "DT": "д4",
         "OP": "о1",
         "Q": "2",
         "T": "411",
         "D": "4",
         "P": "174"
      },

      {
         "id":27,
         "WC": "рц_2",
         "PL": "5",
         "DT": "д5",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":28,
         "WC": "рц_2",
         "PL": "6",
         "DT": "д6",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":29,
         "WC": "рц_2",
         "PL": "7",
         "DT": "д7",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":30,
         "WC": "рц_2",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "1",
         "T": "670",
         "D": "6",
         "P": "97"
      },

      {
         "id":31,
         "WC": "рц_2",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "1",
         "T": "875",
         "D": "4",
         "P": "123"
      },

      {
         "id":32,
         "WC": "рц_2",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "1",
         "T": "300",
         "D": "8",
         "P": "55"
      },

      {
         "id":33,
         "WC": "рц_2",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "1",
         "T": "430",
         "D": "6",
         "P": "145"
      },

      {
         "id":34,
         "WC": "рц_3",
         "PL": "1",
         "DT": "д1",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":35,
         "WC": "рц_3",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "3",
         "T": "687",
         "D": "4",
         "P": "2700"
      },

      {
         "id":36,
         "WC": "рц_3",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "3",
         "T": "750",
         "D": "4",
         "P": "2100"
      },

      {
         "id":37,
         "WC": "рц_3",
         "PL": "2",
         "DT": "д2",
         "OP": "о1",
         "Q": "3",
         "T": "899",
         "D": "0",
         "P": "5850"
      },

      {
         "id":38,
         "WC": "рц_3",
         "PL": "5",
         "DT": "д5",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":39,
         "WC": "рц_3",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "2",
         "T": "440",
         "D": "7",
         "P": "180"
      },

      {
         "id":40,
         "WC": "рц_3",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "2",
         "T": "634",
         "D": "3",
         "P": "620"
      },

      {
         "id":41,
         "WC": "рц_3",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "2",
         "T": "600",
         "D": "5",
         "P": "468"
      },

      {
         "id":42,
         "WC": "рц_3",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "2",
         "T": "300",
         "D": "6",
         "P": "258"
      },

      {
         "id":43,
         "WC": "рц_3",
         "PL": "6",
         "DT": "д6",
         "OP": "о1",
         "Q": "2",
         "T": "780",
         "D": "4",
         "P": "560"
      },

      {
         "id":44,
         "WC": "рц_3",
         "PL": "7",
         "DT": "д7",
         "OP": "о1",
         "Q": "1",
         "T": "200",
         "D": "3",
         "P": "500"
      },

      {
         "id":45,
         "WC": "рц_3",
         "PL": "7",
         "DT": "д7",
         "OP": "о1",
         "Q": "1",
         "T": "158",
         "D": "4",
         "P": "480"
      },

      {
         "id":46,
         "WC": "рц_3",
         "PL": "7",
         "DT": "д7",
         "OP": "о1",
         "Q": "1",
         "T": "765",
         "D": "1",
         "P": "1100"
      },

      {
         "id":47,
         "WC": "рц_3",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "2",
         "T": "672",
         "D": "6",
         "P": "5400"
      },

      {
         "id":48,
         "WC": "рц_3",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "2",
         "T": "786",
         "D": "4",
         "P": "4690"
      },

      {
         "id":49,
         "WC": "рц_3",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "2",
         "T": "765",
         "D": "8",
         "P": "2512"
      },

      {
         "id":50,
         "WC": "рц_3",
         "PL": "8",
         "DT": "д8",
         "OP": "о1",
         "Q": "2",
         "T": "456",
         "D": "6",
         "P": "3956"
      },

      {
         "id":51,
         "WC": "рц_4",
         "PL": "1",
         "DT": "д1",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":52,
         "WC": "рц_4",
         "PL": "2",
         "DT": "д2",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":53,
         "WC": "рц_4",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "1",
         "T": "120",
         "D": "3",
         "P": "99"
      },

      {
         "id":54,
         "WC": "рц_4",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "1",
         "T": "360",
         "D": "5",
         "P": "60"
      },

      {
         "id":55,
         "WC": "рц_4",
         "PL": "3",
         "DT": "д3",
         "OP": "о1",
         "Q": "1",
         "T": "220",
         "D": "1",
         "P": "70"
      },

      {
         "id":56,
         "WC": "рц_4",
         "PL": "4",
         "DT": "д4",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":57,
         "WC": "рц_4",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "4",
         "T": "917",
         "D": "1",
         "P": "12320"
      },

      {
         "id":58,
         "WC": "рц_4",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "4",
         "T": "765",
         "D": "4",
         "P": "7760"
      },

      {
         "id":59,
         "WC": "рц_4",
         "PL": "5",
         "DT": "д5",
         "OP": "о1",
         "Q": "4",
         "T": "919",
         "D": "2",
         "P": "8300"
      },

      {
         "id":60,
         "WC": "рц_4",
         "PL": "6",
         "DT": "д6",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":61,
         "WC": "рц_4",
         "PL": "7",
         "DT": "д7",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      },

      {
         "id":62,
         "WC": "рц_4",
         "PL": "8",
         "DT": "д8",
         "OP": "",
         "Q": "",
         "T": "",
         "D": "",
         "P": ""
      }
];
				document.getElementById('a').innerHTML = maketable(pln);
				document.getElementById('b').innerHTML = maketable(prm);

				let sch = plan(pln, prm, srt);
				document.getElementById('c').innerHTML = maketable(sch);
			}  catch(e) {
				console.log(scriptname +":\n" + e.name + "\n" + e.message);
			}
		};
		js.onerror = function () {
			console.log(scriptname +":\n не найден");
		}
		firstScript.parentNode.insertBefore(js, firstScript);
		init = true;
	} catch(e) {
		console.log(scriptname +":<br>" + e.name + "<br>" + e.message);
	}
  })
});
</script>

</head>

<body>
	<div id="input" class="input">
		<br>Скрипт с функцией планирования:
			<input type=text size=60 id="module" value="plan1.js"/>
		<br>Порядок сортировки:
			<input type=number min="1" id="sort" value="1"/>
		<br><input type=checkbox id="v">Выводить исходные данные
		<br><button id="submit">Запустить проверку</button>
		</div>
		<div id="output" class="output">
		  <div id="a" style='width:95%;text-align:left;font-weight:bold;padding:10px;'>..............</div>
		  <div id="b" style='width:95%;text-align:left;font-weight:bold;padding:10px;'>..............</div>
		  <div id="c" style='width:95%;text-align:left;font-weight:bold;padding:10px;'>..............</div>
		</div> 
</body>
</html>
